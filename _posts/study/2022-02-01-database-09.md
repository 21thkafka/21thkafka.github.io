---
layout: post
title:  "[Database] cube, with"
subtitle:   "cube, with"
categories: study
tags: database
comments: true
---


## cube
---
cube는 중간 합계를 낼 때 사용된다. 다음 sql문을 실행해보자

```
select item_cd, unit, sum(qty)
from procure_procure_request
where (procure_request_date = '20170103' or procure_request_date = '20170104')
group by cube(item_cd, unit)
order by unit;
```
실행하면 item_cd 별로 해당되는 procure_request_date의 qty 합계를 내는 것을 확인할 수 있다.

## with
---
어떤 특정한 데이터들을 뭉치로 묶고 그 중에 뽑아서 쓸 때 with를 쓴다.

```
with get_some(procure_request_no, item_cd, qty)
as
(select procure_request_no, item_cd, qty
from procure_procure_request
where procure_request_date = '20170103'
or procure_request_date = '20170104'
or procure_request_date = '20170105')
select * from get_some order by qty asc;
```
with 옆에 가상 테이블을 쓰고 () 안에 특정 데이터를 뽑을 select 문을 쓴다. 그런다음 괄호를 닫고 뽑아서 쓸 데이터를 가져올 select 문을 쓴다. 이 with 문을 아래와 같이 sum()로 응용할 수 있다. 

```
with get_some(procure_request_no, item_cd, qty)
as
(select procure_request_no, item_cd, qty
from procure_procure_request
where procure_request_date = '20170103'
or procure_request_date = '20170104'
or procure_request_date = '20170105')
select sum(qty) from get_some order by qty asc;
```