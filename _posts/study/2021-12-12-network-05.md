---
layout: post
title:  "[네트워크] HTTP 기초 - HTTP 메서드"
subtitle:   "HTTP 05"
categories: study
tags: network, HTTP
comments: true
---

# HTTP 메서드

- 목차
    - [1.HTTP API를 만들어보자](#1.API)
    - [2.HTTP 메서드](#2.GET,POST)
    - [3.HTTP메서드속성](#3.안전,멱등,캐시가능)


## 1. HTTP API를 만들어보자
---

예를 들어 다음과 같이 회원 관리 API를 만든다 생각해보자. 그럼 다음과 같이 지을 것이다.

- 회원 목록 조회 /read-member-list
- 회원 조회 /read-member-by-id
- 회원 등록 /create-member
- 회원 수정 /update-member
- 회원 삭제 /delete-member

일단 그럴 듯 해 보이는데 이것은 좋은 URI 설계일까?<br>
<br>
가장 중요한 것은 리소스 구별이다.<br>
리소스의 의미는 뭘까? <br>
회원을 등록하고 수정하고 조회하는게 리소스가 아니다. 회원이라는 개념 자체가 바로 리소스이다.<br>
그럼 이걸 적용하면 위 API를 어떻게 수정할까? 회원을 등록하고 수정하고 조회하는 것을 모두 배제한다. 회원이라는 리소스만 식별하면 된다. 회원리소스를 URI에 매핑한다. 그러므로 수정하면 다음과 같이 된다.

- __회원__ 목록 조회
- __회원__ 조회
- __회원__ 등록
- __회원__ 수정
- __회원__ 삭제

URI는 리소스만 식별해야하고 리소스와 행위를 분리해야한다. 리소스가 회원이라면 행위는 조회, 등록, 삭제, 변경이다. 그러나 리소스만으로는 구분이 불가능해진다. 그럼 행위(메서드)는 어떻게 구분해야 할까? 이를 구분하기 위해 메서드를 사용한다.

## 2. HTTP 메서드
---
HTTP 메서드(최근에는 Representation으로 명칭이 변했다)에는 대표적으로 GET, POST, PUT, PATCH, DELETE가 있다.

- GET: 리소스 조회
- POST: 요청 데이터 처리, 주로 등록에 사용
- PUT: 리소스를 대체, 해당 리소스가 없으면 생성
- PATCH: 리소스 부분 변경
- DELETE: 리소스 삭제

저것 외에도 HEAD, POTIONS, CONNECT, TRACE 기타 메서드가 있다.

- HEAD: GET과 동일하지만 메시지 부분을 제외하고, 상태 줄과 헤더만 반환
- OPTIONS: 대상 리소스에 대한 통신 가능 옵션(메서드)을 설명(주로 CORS에서 사용)
- CONNECT: 대상 자원으로 식별되는 서버에 대한 터널을 설정
- TRACE: 대상 리소스에 댛나 경로를 따라 메시지 루프백 테스트를 수행

CONNECT와 TRACE는 거의 사용되지 않는다.

### 2.1 GET

- 리소스 조회
- 서버에 전달하고 싶은 데이터는 query를 통해서 전달
- 메시지 바디를 사용해서 데이터를 전달할수 있지만, 지원하지 않는 곳이 많아서 권장하지 않음

GET은 클라이언트가 어떤 데이터가 필요하니 서버에게 달라는 요청 메시지이다. GET 메시지를 받으면 서버는 요청한 데이터를 다시 보내주는 방식으로 진행된다. 그러나 POST는 조금 다르다.

### 2.2 POST

- 요청 데이터 처리
- 메시지 바디를 통해 서버로 요청 데이터 전달
- 서버는 요청 데이터를 처리
    - 메시지 바디를 통해 들어온 데이터를 처리하는 모든 기능을 수행한다.
- 주로 전달된 데이터로 신규 리소스 등록, 플세스 처리에 사용


POST같은 경우 GET과 달리 클라이언트가 먼저 데이터를 보내며 이 데이터를 처리해달라고 요청하는 것이다. 주로 신규회원 등록같이 데이터를 DB에 저장하거나, 회원 정보 수정같이 UPDATE를 할 때 사용된다.<br>
사실, POST는 의미가 넓다. 요청 데이터를 처리한다는 의미는 다음과 같다.

- 스펙: POST 메서드는 대상 리소스가 리소스의 고유 한 의미 체계에 따라 요청에 포함 된 표현을 처리하도록 요청합니다.

예를 들어 post는 다음과 같은 기능에 사용된다.
- HTML 양식에 입력 된 필드와 같은 데이터 블록을 데이터 처리 프로세스에 제공 : 회원가입, 주문 등
- 게시판, 뉴스 그륩, 메일링 리스트, 블로그 또는 유사한 기사 그룹에 메시지 게시 : 게시판 글쓰기, 댓글
- 서버가 아직 식별하지 않은 새 리소스 생성 : 신규 주문 생성
- 기존 자원에 데이터 추가 : 한 문서에 끝에 내용 추가

정리 : 이 리소스 URI에 POST 요청이 오면 요청 데이털르 어떻게 처리할지 리소스마다 따로 정해야한다.

1. 새 리소스 생성(등록) : 서머가 아직 식별하지 않은 새 리소스 생성
2. 요청 데이터 처리
    - 단순히 데이터를 생성하거나, 변경하는 것을 넘어서 프로세스를 처리해야 하는 경우
    - POST의 결과로 새로운 리소스가 생성되지 않을 수도 있음 : 최대한 리소스만 URI 설계해야하지만 어쩔 수 없이 행위를 넣을 경우 컨트롤 URI라고 함
3. 다른 메서드로 처리하기 애매한 경우
    - JSON으로 조회 데이터를 넘겨야할 경우, GET은 지원하지 않는 서버가 많아 POST로 사용

그러나 조회하는 경우는 되도록이면 GET을 쓰는 것이 바람직하다.

### 2.3 PUT, PATCH, DELETE

PUT은 일종의 파일 덮어쓰기와 비슷한다. 파일을 복사하는데 같은 파일이 없으면 새로 생성하고 같은 파일이 있으면 덮어버리는 것과 같다.

- 리소스가 있으면 대체
- 리소스가 없으면 생성

중요한 것은 클라이언트가 리소스를 식별한다. 클라이언트가 리소스 위치를 알고 URI 지정하는 것이 POST와 큰차이점이다.<br>
기존의 데이터를 완전히 날리고 새로 대체해버리는 PUT은 부분적인 정보 수정이 힘들다. 그래서 그럴 때는 PATCH를 쓴다. PATCH는 리소스 부분만 변경하는 것이다.<br>
그리고 DELETE는 형태 그대로 리소스를 삭제한다. 딱히 설명할 내용이 없다.<br>
때로 일부 서버에서는 PATCH가 지원이 안되는 경우도 있다. 그럴때는 POST를 쓰면 된다^^ (만능 POST)

## 3. HTTP 속성
---

- 안전(Safe Methods)
- 멱등(Idempotent Methods)
- 캐시가능(Cacheable Methods)

### 3.1 안전
안전은 호출해도 리소스를 변경하지 않는 것을 뜻한다. 이를 생각해보면 GET은 조회만 하기 때문에 안전하다고 할 수 있다. 그러나 POST나 PUT, PATCH는 변경이 일어나기 때문에 안전하지 않다. <br>

### 3.2 멱등
멱등은 한 번 호출하든 두 번 호출하든 100번 호출하든 결과가 똑같다는 것을 말한다. 다만 외부 요인으로 중간에 리소스가 변경되는 것은 배제한다.

- GET : 한 번 조회하든, 두 번 조회하든 같은 결과가 조회
- PUT : 결과를 대체. 따라서 같은 요청을 여러번 해도 최종 결과는 같다.
- DELETE : 결과를 삭제. 같은 요청을 여러번 해도 삭제된 결과는 같다.
- POST : 두 번 호출하면 같은 결제가 중복 발생하므로 멱등이 아님. 

이런 멱등이라는 개념은 자동 복구 메커니즘을 사용할 때 쓰인다. 서버가 정상 응답을 못주었을 때, 클라이언트가 같은 요청을 다시 해도 되는가의 판단 근거로 쓰인다.

### 3.3 캐시가능

응답 결과 리소스를 캐시해서 사용해도 되는가를 말한다. 캐시란 간단하게 설명하면 서버에서 한번 불러온 데이터를 로컬 웹브라우저에 저장하여 쓰는 것이다.<br>
GET, HEAD, POST, PATCH 캐시 가능하지만 실제로는 GET, HEAD 정도만 캐시로 사용한다.<br>
POST, PATCH는 본문 내용까지 캐시 키로 고려해야 하는데, 구현이 쉽지 않다.
